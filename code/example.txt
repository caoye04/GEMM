$ source /home/software/spack/share/spack/setup-env.sh
$ spack load intel-oneapi-compilers@2022.2.1 intel-oneapi-mkl@2022.2.1
$ icc --version -diag-disable=10441
icc (ICC) 2021.7.1 20221019
Copyright (C) 1985-2022 Intel Corporation.  All rights reserved.

$ make
rm -f benchmark-test benchmark-naive benchmark-blocked benchmark-blas benchmark-test.o benchmark.o sgemm-naive.o sgemm-blocked.o sgemm-blas.o
icc -c -Wall -DGETTIMEOFDAY -std=c99  -diag-disable=10441 benchmark-test.c
icc -c -Wall -DGETTIMEOFDAY -std=c99  -diag-disable=10441 sgemm-blocked.c
icc -o benchmark-test benchmark-test.o sgemm-blocked.o -qmkl=sequential -lpthread -lm -diag-disable=10441
icc -c -Wall -DGETTIMEOFDAY -std=c99  -diag-disable=10441 benchmark.c
icc -c -Wall -DGETTIMEOFDAY -std=c99  -diag-disable=10441 sgemm-naive.c
icc -o benchmark-naive benchmark.o sgemm-naive.o -qmkl=sequential -lpthread -lm -diag-disable=10441
icc -o benchmark-blocked benchmark.o sgemm-blocked.o -qmkl=sequential -lpthread -lm -diag-disable=10441
icc -c -Wall -DGETTIMEOFDAY -std=c99  -diag-disable=10441 sgemm-blas.c
icc -o benchmark-blas benchmark.o sgemm-blas.o -qmkl=sequential -lpthread -lm -diag-disable=10441

$ srun -n 1 ./benchmark-blocked
Description:	Simple blocked sgemm.

Size: 31	Gflop/s: 3.23 (8192 iter, 0.151 seconds)
Size: 32	Gflop/s: 3.21 (8192 iter, 0.167 seconds)
Size: 33	Gflop/s: 3.2 (8192 iter, 0.184 seconds)
Size: 63	Gflop/s: 3.03 (1024 iter, 0.169 seconds)
Size: 64	Gflop/s: 3.04 (1024 iter, 0.177 seconds)
Size: 65	Gflop/s: 3.04 (1024 iter, 0.185 seconds)
Size: 95	Gflop/s: 2.95 (256 iter, 0.149 seconds)
Size: 96	Gflop/s: 2.96 (256 iter, 0.153 seconds)
Size: 97	Gflop/s: 2.96 (256 iter, 0.158 seconds)
Size: 127	Gflop/s: 2.92 (128 iter, 0.180 seconds)
Size: 128	Gflop/s: 2.88 (128 iter, 0.186 seconds)
Size: 129	Gflop/s: 2.92 (128 iter, 0.188 seconds)
Size: 159	Gflop/s: 2.97 (64 iter, 0.174 seconds)
Size: 160	Gflop/s: 2.96 (64 iter, 0.177 seconds)
Size: 161	Gflop/s: 2.94 (64 iter, 0.181 seconds)
Size: 191	Gflop/s: 2.97 (32 iter, 0.150 seconds)
Size: 192	Gflop/s: 2.97 (32 iter, 0.152 seconds)
Size: 193	Gflop/s: 2.97 (32 iter, 0.155 seconds)
Size: 223	Gflop/s: 2.95 (16 iter, 0.120 seconds)
Size: 224	Gflop/s: 2.95 (16 iter, 0.122 seconds)
Size: 225	Gflop/s: 2.95 (16 iter, 0.124 seconds)
Size: 255	Gflop/s: 2.91 (16 iter, 0.182 seconds)
Size: 256	Gflop/s: 2.9 (16 iter, 0.185 seconds)
Size: 257	Gflop/s: 2.92 (16 iter, 0.186 seconds)
Size: 287	Gflop/s: 2.93 (8 iter, 0.129 seconds)
Size: 288	Gflop/s: 2.92 (8 iter, 0.131 seconds)
Size: 289	Gflop/s: 2.91 (8 iter, 0.133 seconds)
Size: 319	Gflop/s: 2.95 (8 iter, 0.176 seconds)
Size: 320	Gflop/s: 2.95 (8 iter, 0.178 seconds)
Size: 321	Gflop/s: 2.95 (8 iter, 0.179 seconds)
Size: 351	Gflop/s: 2.94 (4 iter, 0.118 seconds)
Size: 352	Gflop/s: 2.95 (4 iter, 0.118 seconds)
Size: 353	Gflop/s: 2.94 (4 iter, 0.120 seconds)
Size: 383	Gflop/s: 2.93 (4 iter, 0.153 seconds)
Size: 384	Gflop/s: 2.92 (4 iter, 0.155 seconds)
Size: 385	Gflop/s: 2.93 (4 iter, 0.156 seconds)
Size: 415	Gflop/s: 2.92 (4 iter, 0.196 seconds)
Size: 416	Gflop/s: 2.92 (4 iter, 0.197 seconds)
Size: 417	Gflop/s: 2.92 (4 iter, 0.199 seconds)
Size: 447	Gflop/s: 2.93 (2 iter, 0.122 seconds)
Size: 448	Gflop/s: 2.93 (2 iter, 0.123 seconds)
Size: 449	Gflop/s: 2.93 (2 iter, 0.124 seconds)
Size: 479	Gflop/s: 2.94 (2 iter, 0.149 seconds)
Size: 480	Gflop/s: 2.94 (2 iter, 0.150 seconds)
Size: 481	Gflop/s: 2.94 (2 iter, 0.151 seconds)
Size: 511	Gflop/s: 2.85 (2 iter, 0.188 seconds)
Size: 512	Gflop/s: 2.67 (2 iter, 0.201 seconds)
Size: 513	Gflop/s: 2.84 (2 iter, 0.190 seconds)
Size: 543	Gflop/s: 2.92 (2 iter, 0.219 seconds)
Size: 544	Gflop/s: 2.93 (2 iter, 0.220 seconds)
Size: 545	Gflop/s: 2.93 (2 iter, 0.221 seconds)
Size: 575	Gflop/s: 2.92 (2 iter, 0.261 seconds)
Size: 576	Gflop/s: 2.91 (2 iter, 0.262 seconds)
Size: 577	Gflop/s: 2.92 (2 iter, 0.264 seconds)
Size: 607	Gflop/s: 2.94 (2 iter, 0.305 seconds)
Size: 608	Gflop/s: 2.94 (2 iter, 0.306 seconds)
Size: 609	Gflop/s: 2.94 (2 iter, 0.308 seconds)
Size: 639	Gflop/s: 2.93 (2 iter, 0.356 seconds)
Size: 640	Gflop/s: 2.93 (2 iter, 0.358 seconds)
Size: 641	Gflop/s: 2.94 (2 iter, 0.359 seconds)
Size: 671	Gflop/s: 2.93 (2 iter, 0.413 seconds)
Size: 672	Gflop/s: 2.93 (2 iter, 0.414 seconds)
Size: 673	Gflop/s: 2.93 (2 iter, 0.416 seconds)
Size: 703	Gflop/s: 2.92 (2 iter, 0.476 seconds)
Size: 704	Gflop/s: 2.92 (2 iter, 0.478 seconds)
Size: 705	Gflop/s: 2.92 (2 iter, 0.480 seconds)
Size: 735	Gflop/s: 2.93 (2 iter, 0.543 seconds)
Size: 736	Gflop/s: 2.93 (2 iter, 0.545 seconds)
Size: 737	Gflop/s: 2.92 (2 iter, 0.548 seconds)
Size: 767	Gflop/s: 2.92 (2 iter, 0.619 seconds)
Size: 768	Gflop/s: 2.91 (2 iter, 0.624 seconds)
Size: 769	Gflop/s: 2.92 (2 iter, 0.624 seconds)
Size: 799	Gflop/s: 2.93 (2 iter, 0.697 seconds)
Size: 800	Gflop/s: 2.93 (2 iter, 0.699 seconds)
Size: 801	Gflop/s: 2.93 (2 iter, 0.702 seconds)
Size: 831	Gflop/s: 2.92 (2 iter, 0.786 seconds)
Size: 832	Gflop/s: 2.92 (2 iter, 0.790 seconds)
Size: 833	Gflop/s: 2.92 (2 iter, 0.791 seconds)
Size: 863	Gflop/s: 2.92 (2 iter, 0.882 seconds)
Size: 864	Gflop/s: 2.92 (2 iter, 0.883 seconds)
Size: 865	Gflop/s: 2.92 (2 iter, 0.887 seconds)
Size: 895	Gflop/s: 2.93 (2 iter, 0.980 seconds)
Size: 896	Gflop/s: 2.92 (2 iter, 0.986 seconds)
Size: 897	Gflop/s: 2.93 (2 iter, 0.986 seconds)
Size: 927	Gflop/s: 2.93 (2 iter, 1.088 seconds)
Size: 928	Gflop/s: 2.93 (2 iter, 1.091 seconds)
Size: 929	Gflop/s: 2.93 (2 iter, 1.094 seconds)
Size: 959	Gflop/s: 2.92 (2 iter, 1.207 seconds)
Size: 960	Gflop/s: 2.92 (2 iter, 1.212 seconds)
Size: 961	Gflop/s: 2.92 (2 iter, 1.214 seconds)
Size: 991	Gflop/s: 2.92 (2 iter, 1.335 seconds)
Size: 992	Gflop/s: 2.92 (2 iter, 1.338 seconds)
Size: 993	Gflop/s: 2.9 (2 iter, 1.351 seconds)
Size: 1023	Gflop/s: 2.79 (2 iter, 1.536 seconds)
Size: 1024	Gflop/s: 2.54 (2 iter, 1.688 seconds)
Size: 1025	Gflop/s: 2.78 (2 iter, 1.547 seconds)

$ srun -n 1 ./benchmark-blas
Description:	Reference sgemm.

Size: 31	Gflop/s: 79 (262144 iter, 0.198 seconds)
Size: 32	Gflop/s: 107 (262144 iter, 0.161 seconds)
Size: 33	Gflop/s: 73.8 (131072 iter, 0.128 seconds)
Size: 63	Gflop/s: 136 (32768 iter, 0.121 seconds)
Size: 64	Gflop/s: 127 (32768 iter, 0.135 seconds)
Size: 65	Gflop/s: 125 (32768 iter, 0.144 seconds)
Size: 95	Gflop/s: 175 (16384 iter, 0.161 seconds)
Size: 96	Gflop/s: 164 (16384 iter, 0.177 seconds)
Size: 97	Gflop/s: 129 (8192 iter, 0.116 seconds)
Size: 127	Gflop/s: 169 (8192 iter, 0.199 seconds)
Size: 128	Gflop/s: 143 (4096 iter, 0.120 seconds)
Size: 129	Gflop/s: 158 (4096 iter, 0.112 seconds)
Size: 159	Gflop/s: 168 (4096 iter, 0.196 seconds)
Size: 160	Gflop/s: 146 (2048 iter, 0.115 seconds)
Size: 161	Gflop/s: 156 (2048 iter, 0.109 seconds)
Size: 191	Gflop/s: 181 (2048 iter, 0.157 seconds)
Size: 192	Gflop/s: 185 (2048 iter, 0.157 seconds)
Size: 193	Gflop/s: 160 (2048 iter, 0.184 seconds)
Size: 223	Gflop/s: 118 (1024 iter, 0.192 seconds)
Size: 224	Gflop/s: 183 (1024 iter, 0.126 seconds)
Size: 225	Gflop/s: 161 (1024 iter, 0.144 seconds)
Size: 255	Gflop/s: 130 (512 iter, 0.131 seconds)
Size: 256	Gflop/s: 178 (1024 iter, 0.193 seconds)
Size: 257	Gflop/s: 159 (512 iter, 0.109 seconds)
Size: 287	Gflop/s: 132 (512 iter, 0.183 seconds)
Size: 288	Gflop/s: 189 (512 iter, 0.129 seconds)
Size: 289	Gflop/s: 170 (512 iter, 0.145 seconds)
Size: 319	Gflop/s: 133 (256 iter, 0.125 seconds)
Size: 320	Gflop/s: 185 (512 iter, 0.182 seconds)
Size: 321	Gflop/s: 168 (256 iter, 0.101 seconds)
Size: 351	Gflop/s: 142 (256 iter, 0.156 seconds)
Size: 352	Gflop/s: 181 (256 iter, 0.124 seconds)
Size: 353	Gflop/s: 166 (256 iter, 0.135 seconds)
Size: 383	Gflop/s: 143 (128 iter, 0.101 seconds)
Size: 384	Gflop/s: 189 (256 iter, 0.154 seconds)
Size: 385	Gflop/s: 172 (256 iter, 0.170 seconds)
Size: 415	Gflop/s: 142 (128 iter, 0.129 seconds)
Size: 416	Gflop/s: 184 (256 iter, 0.200 seconds)
Size: 417	Gflop/s: 172 (128 iter, 0.108 seconds)
Size: 447	Gflop/s: 150 (128 iter, 0.153 seconds)
Size: 448	Gflop/s: 181 (128 iter, 0.127 seconds)
Size: 449	Gflop/s: 170 (128 iter, 0.137 seconds)
Size: 479	Gflop/s: 151 (128 iter, 0.187 seconds)
Size: 480	Gflop/s: 188 (128 iter, 0.150 seconds)
Size: 481	Gflop/s: 177 (128 iter, 0.161 seconds)
Size: 511	Gflop/s: 149 (64 iter, 0.114 seconds)
Size: 512	Gflop/s: 180 (128 iter, 0.191 seconds)
Size: 513	Gflop/s: 174 (128 iter, 0.199 seconds)
Size: 543	Gflop/s: 158 (64 iter, 0.130 seconds)
Size: 544	Gflop/s: 185 (64 iter, 0.111 seconds)
Size: 545	Gflop/s: 176 (64 iter, 0.118 seconds)
Size: 575	Gflop/s: 158 (64 iter, 0.154 seconds)
Size: 576	Gflop/s: 193 (64 iter, 0.127 seconds)
Size: 577	Gflop/s: 183 (64 iter, 0.134 seconds)
Size: 607	Gflop/s: 157 (64 iter, 0.182 seconds)
Size: 608	Gflop/s: 192 (64 iter, 0.150 seconds)
Size: 609	Gflop/s: 182 (64 iter, 0.159 seconds)
Size: 639	Gflop/s: 165 (32 iter, 0.101 seconds)
Size: 640	Gflop/s: 191 (64 iter, 0.176 seconds)
Size: 641	Gflop/s: 182 (64 iter, 0.186 seconds)
Size: 671	Gflop/s: 165 (32 iter, 0.117 seconds)
Size: 672	Gflop/s: 196 (64 iter, 0.198 seconds)
Size: 673	Gflop/s: 187 (32 iter, 0.104 seconds)
Size: 703	Gflop/s: 165 (32 iter, 0.135 seconds)
Size: 704	Gflop/s: 195 (32 iter, 0.114 seconds)
Size: 705	Gflop/s: 187 (32 iter, 0.120 seconds)
Size: 735	Gflop/s: 170 (32 iter, 0.149 seconds)
Size: 736	Gflop/s: 194 (32 iter, 0.132 seconds)
Size: 737	Gflop/s: 185 (32 iter, 0.138 seconds)
Size: 767	Gflop/s: 170 (32 iter, 0.170 seconds)
Size: 768	Gflop/s: 196 (32 iter, 0.148 seconds)
Size: 769	Gflop/s: 183 (32 iter, 0.159 seconds)
Size: 799	Gflop/s: 166 (32 iter, 0.197 seconds)
Size: 800	Gflop/s: 191 (32 iter, 0.171 seconds)
Size: 801	Gflop/s: 184 (32 iter, 0.178 seconds)
Size: 831	Gflop/s: 171 (16 iter, 0.108 seconds)
Size: 832	Gflop/s: 191 (32 iter, 0.193 seconds)
Size: 833	Gflop/s: 183 (16 iter, 0.101 seconds)
Size: 863	Gflop/s: 169 (16 iter, 0.122 seconds)
Size: 864	Gflop/s: 195 (16 iter, 0.106 seconds)
Size: 865	Gflop/s: 188 (16 iter, 0.110 seconds)
Size: 895	Gflop/s: 172 (16 iter, 0.133 seconds)
Size: 896	Gflop/s: 196 (16 iter, 0.117 seconds)
Size: 897	Gflop/s: 190 (16 iter, 0.122 seconds)
Size: 927	Gflop/s: 177 (16 iter, 0.144 seconds)
Size: 928	Gflop/s: 195 (16 iter, 0.131 seconds)
Size: 929	Gflop/s: 186 (16 iter, 0.138 seconds)
Size: 959	Gflop/s: 177 (16 iter, 0.160 seconds)
Size: 960	Gflop/s: 200 (16 iter, 0.141 seconds)
Size: 961	Gflop/s: 194 (16 iter, 0.147 seconds)
Size: 991	Gflop/s: 176 (16 iter, 0.177 seconds)
Size: 992	Gflop/s: 199 (16 iter, 0.157 seconds)
Size: 993	Gflop/s: 190 (16 iter, 0.165 seconds)
Size: 1023	Gflop/s: 175 (16 iter, 0.196 seconds)
Size: 1024	Gflop/s: 189 (16 iter, 0.182 seconds)
Size: 1025	Gflop/s: 185 (16 iter, 0.186 seconds)
